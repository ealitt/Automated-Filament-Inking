"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),n=require("@react-three/fiber"),r=require("three"),t=require("three-stdlib"),s=require("../helpers/environment-assets.cjs.js");function o(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,t.get?t:{enumerable:!0,get:function(){return e[r]}})}})),n.default=e,Object.freeze(n)}var u=o(e);const a=e=>{return(n=e).current&&n.current.isScene?e.current:e;var n};function c({scene:e,background:r=!1,map:t}){const s=n.useThree((e=>e.scene));return u.useLayoutEffect((()=>{if(t){const n=a(e||s),o=n.background,u=n.environment;return"only"!==r&&(n.environment=t),r&&(n.background=t),()=>{"only"!==r&&(n.environment=u),r&&(n.background=o)}}}),[e,t]),null}function i({children:e,near:t=1,far:s=1e3,resolution:o=256,frames:i=1,background:l=!1,scene:p,files:f,path:m,preset:b,extensions:d}){const g=n.useThree((e=>e.gl)),y=n.useThree((e=>e.scene)),v=u.useRef(null),[h]=u.useState((()=>new r.Scene)),E=u.useMemo((()=>{const e=new r.WebGLCubeRenderTarget(o);return e.texture.type=r.HalfFloatType,e}),[o]);u.useLayoutEffect((()=>{1===i&&v.current.update(g,h);const e=a(p||y),n=e.background,r=e.environment;return"only"!==l&&(e.environment=E.texture),l&&(e.background=E.texture),()=>{"only"!==l&&(e.environment=r),l&&(e.background=n)}}),[e,p]);let k=1;return n.useFrame((()=>{(i===1/0||k<i)&&(v.current.update(g,h),k++)})),u.createElement(u.Fragment,null,n.createPortal(u.createElement(u.Fragment,null,e,u.createElement("cubeCamera",{ref:v,args:[t,s,E]}),(f||b)&&u.createElement(c,{background:!0,files:f,preset:b,path:m,extensions:d,scene:h})),h))}function l({background:e=!1,files:o=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:c="",preset:i,scene:l,extensions:p}){if(i){if(!(i in s.presetsObj))throw new Error("Preset must be one of: "+Object.keys(s.presetsObj).join(", "));o=s.presetsObj[i],c="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}const f=n.useThree((e=>e.scene)),m=Array.isArray(o),b=m?r.CubeTextureLoader:t.RGBELoader,d=n.useLoader(b,m?[o]:o,(e=>{e.setPath(c),null==e.setDataType||e.setDataType(r.FloatType),p&&p(e)})),g=m?d[0]:d;return g.mapping=r.EquirectangularReflectionMapping,u.useLayoutEffect((()=>{const n=a(l||f),r=n.background,t=n.environment;return"only"!==e&&(n.environment=g),e&&(n.background=g),()=>{"only"!==e&&(n.environment=t),e&&(n.background=r),g.dispose()}}),[g,e,l]),null}exports.Environment=function(e){return e.map?u.createElement(c,e):e.children?u.createElement(i,e):u.createElement(l,e)},exports.EnvironmentCube=l,exports.EnvironmentMap=c,exports.EnvironmentPortal=i;
