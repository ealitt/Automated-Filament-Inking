"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,o,t,n,r,i,u=require("three"),c=require("../core/TempNode.cjs.js"),a=require("../core/ConstNode.cjs.js"),v=require("../core/FunctionNode.cjs.js");function p(e,o){c.TempNode.call(this,"v4"),this.input=e,this.method=o||p.LINEAR_TO_LINEAR}require("../core/Node.cjs.js"),require("../core/NodeLib.cjs.js"),p.Nodes=(e=new v.FunctionNode(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),o=new v.FunctionNode(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),t=new v.FunctionNode(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n")),n=new a.ConstNode("const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );"),r=new v.FunctionNode(["vec4 LinearToLogLuv( in vec4 value ) {","\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;","\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));","\tvec4 vResult;","\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;","\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;","\tvResult.w = fract(Le);","\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;","\treturn vResult;","}"].join("\n"),[n]),i=new a.ConstNode("const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );"),{LinearToLinear:e,sRGBToLinear:o,LinearTosRGB:t,cLogLuvM:n,LinearToLogLuv:r,cLogLuvInverseM:i,LogLuvToLinear:new v.FunctionNode(["vec4 LogLuvToLinear( in vec4 value ) {","\tfloat Le = value.z * 255.0 + value.w;","\tvec3 Xp_Y_XYZp;","\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);","\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;","\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;","\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;","\treturn vec4( max(vRGB, 0.0), 1.0 );","}"].join("\n"),[i])}),p.LINEAR_TO_LINEAR="LinearToLinear",p.SRGB_TO_LINEAR="sRGBToLinear",p.LINEAR_TO_SRGB="LinearTosRGB",p.RGBE_TO_LINEAR="RGBEToLinear",p.LINEAR_TO_RGBE="LinearToRGBE",p.LINEAR_TO_LOG_LUV="LinearToLogLuv",p.LOG_LUV_TO_LINEAR="LogLuvToLinear",p.getEncodingComponents=function(e){switch(e){case u.LinearEncoding:return["Linear"];case u.sRGBEncoding:return["sRGB"]}},p.prototype=Object.create(c.TempNode.prototype),p.prototype.constructor=p,p.prototype.nodeType="ColorSpace",p.prototype.hashProperties=["method"],p.prototype.generate=function(e,o){var t=this.input.build(e,"v4"),n=this.getType(e),r=p.Nodes[this.method],i=e.include(r);if(i===p.LINEAR_TO_LINEAR)return e.format(t,n,o);if(2===r.inputs.length){var u=this.factor.build(e,"f");return e.format(i+"( "+t+", "+u+" )",n,o)}return e.format(i+"( "+t+" )",n,o)},p.prototype.fromEncoding=function(e){var o=p.getEncodingComponents(e);this.method="LinearTo"+o[0],this.factor=o[1]},p.prototype.fromDecoding=function(e){var o=p.getEncodingComponents(e);this.method=o[0]+"ToLinear",this.factor=o[1]},p.prototype.copy=function(e){return c.TempNode.prototype.copy.call(this,e),this.input=e.input,this.method=e.method,this},p.prototype.toJSON=function(e){var o=this.getJSONNode(e);return o||((o=this.createJSONNode(e)).input=this.input.toJSON(e).uuid,o.method=this.method),o},exports.ColorSpaceNode=p;
