"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./TempNode.cjs.js"),t=require("./NodeLib.cjs.js");require("three"),require("./Node.cjs.js");var s=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,i=/[a-z_0-9]+/gi;function o(t,s,i,o,r){this.isMethod=void 0===r,this.isInterface=!1,e.TempNode.call(this,r),this.parse(t,s,i,o)}o.prototype=Object.create(e.TempNode.prototype),o.prototype.constructor=o,o.prototype.nodeType="Function",o.prototype.useKeywords=!0,o.prototype.getShared=function(){return!this.isMethod},o.prototype.getType=function(e){return e.getTypeByFormat(this.type)},o.prototype.getInputByName=function(e){for(var t=this.inputs.length;t--;)if(this.inputs[t].name===e)return this.inputs[t]},o.prototype.getIncludeByName=function(e){for(var t=this.includes.length;t--;)if(this.includes[t].name===e)return this.includes[t]},o.prototype.generate=function(e,s){var o=0,r=this.src;for(let t=0;t<this.includes.length;t++)e.include(this.includes[t],this);for(let t in this.extensions)e.extensions[t]=!0;for(var n=[];h=i.exec(this.src);)n.push(h);for(let s=0;s<n.length;s++){var h,d=(h=n[s])[0],u=!this.isMethod||!this.getInputByName(d),p=d;if(this.keywords[d]||this.useKeywords&&u&&t.NodeLib.containsKeyword(d)){var c=this.keywords[d];if(!c){var y=t.NodeLib.getKeywordData(d);y.cache&&(c=e.keywords[d]),c=c||t.NodeLib.getKeyword(d,e),y.cache&&(e.keywords[d]=c)}p=c.build(e)}d!==p&&(r=r.substring(0,h.index+o)+p+r.substring(h.index+d.length+o),o+=p.length-d.length),void 0===this.getIncludeByName(p)&&t.NodeLib.contains(p)&&e.include(t.NodeLib.get(p))}return"source"===s?r:this.isMethod?(this.isInterface||e.include(this,!1,r),this.name):e.format("( "+r+" )",this.getType(e),s)},o.prototype.parse=function(e,t,o,r){if(this.src=e||"",this.includes=t||[],this.extensions=o||{},this.keywords=r||{},this.isMethod){var n=this.src.match(s);if(this.inputs=[],n&&4==n.length){this.type=n[1],this.name=n[2];var h=n[3].match(i);if(h)for(var d=0;d<h.length;){var u,p,c=h[d++];"in"===c||"out"===c||"inout"===c?u=h[d++]:(u=c,c=""),p=h[d++],this.inputs.push({name:p,type:u,qualifier:c})}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}},o.prototype.copy=function(t){return e.TempNode.prototype.copy.call(this,t),this.isMethod=t.isMethod,this.useKeywords=t.useKeywords,this.parse(t.src,t.includes,t.extensions,t.keywords),void 0!==t.type&&(this.type=t.type),this},o.prototype.toJSON=function(e){var t=this.getJSONNode(e);if(!t){(t=this.createJSONNode(e)).src=this.src,t.isMethod=this.isMethod,t.useKeywords=this.useKeywords,this.isMethod||(t.type=this.type),t.extensions=JSON.parse(JSON.stringify(this.extensions)),t.keywords={};for(let s in this.keywords)t.keywords[s]=this.keywords[s].toJSON(e).uuid;if(this.includes.length){t.includes=[];for(let s=0;s<this.includes.length;s++)t.includes.push(this.includes[s].toJSON(e).uuid)}}return t},exports.FunctionNode=o;
